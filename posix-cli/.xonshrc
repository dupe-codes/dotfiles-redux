# Configure path
$PATH.append(f'{$HOME}/.local/bin')

$XONSH_SHOW_TRACEBACK = True

# Set up CLI utils
execx($(starship init xonsh))
execx($(zoxide init xonsh), 'exec', __xonsh__.ctx, filename='zoxide')

# TODO: Configure mambaforge

# Tmux launch command
def _launch_tmux_session():
    import subprocess
    import time

    def tmux(command):
        return subprocess.run(["tmux"] + command.split(), stdout=subprocess.PIPE)

    def gum_spin(window_name):
        subprocess.run(
            ["gum", "spin", "--spinner", "dot", "--title", f"Creating window '{window_name}' ...", " -- sleep 0.8"],
            stdout=subprocess.PIPE
        )
        time.sleep(0.8)

    result = tmux("list-sessions")
    if "gigacli:" in result.stdout.decode():
        tmux("attach-session -t gigacli")
    else:
        windows = ["code", "terminal", "timer", "music"]
        print("Creating giga tmux session ...")

        tmux(f"new-session -s gigacli -d -n {windows[0]}")
        gum_spin(windows[0])
        for window in windows[1:]:
            tmux(f"new-window -t gigacli -n {window}")
            gum_spin(window)

        tmux("attach-session -t gigacli:1")

aliases['tm'] = _launch_tmux_session

# github copilot cli aliases
def what_the_shell(args, stdin=None):
    $(github-copilot-cli what-the-shell @(args))

def git_assist(args, stdin=None):
    $(github-copilot-cli git-assist @(args))

aliases['??'] = what_the_shell
aliases['git?'] = git_assist
